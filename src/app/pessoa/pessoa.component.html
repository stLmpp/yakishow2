<div class="page-title">
  <h2>Pessoas</h2>
  <div>
    <button mat-raised-button color="accent" [routerLink]="['./', 'novo']">
      Novo
    </button>
  </div>
</div>
<mat-form-field class="search">
  <input
    type="search"
    autocomplete="off"
    matInput
    [formControl]="searchControl"
  />
  <mat-label> <mat-icon>search</mat-icon> Pesquisar </mat-label>
  <mat-hint>Pesquise pelo nome ou celular</mat-hint>
</mat-form-field>
<mat-nav-list>
  <virtual-scroller
    *ngLet="
      searchControl.pristine ? searchControl.value : (search$ | async) as search
    "
    [items]="
      pessoaQuery.all$
        | async
        | filter: ['nome', 'celular']:search
        | orderBy: ['nome', 'celular']
    "
    [parentScroll]="window"
    (vsUpdate)="viewPortItems = $event"
    [compareItems]="comparePessoa"
    [bufferAmount]="4"
    #virtualScroller
  >
    <mat-list-item
      *ngFor="let pessoa of viewPortItems; trackBy: trackByPessoa"
      [routerLink]="['./', 'edit', pessoa.id]"
      (click)="idPessoaParam = pessoa.id"
      [class.active]="pessoa.id === idPessoaParam"
    >
      <mat-icon matListIcon>person</mat-icon>
      <button
        mat-icon-button
        matSuffix
        [matMenuTriggerFor]="menu"
        (click)="$event.stopPropagation()"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button
          mat-menu-item
          [routerLink]="['/', 'pedidos', 'novo']"
          [queryParams]="{ celular: pessoa.celular }"
        >
          Fazer pedido
        </button>
        <button
          mat-menu-item
          (click)="idPessoaParam = pessoa.id"
          [routerLink]="['./', 'edit', pessoa.id]"
        >
          Editar
        </button>
        <button mat-menu-item>Ver Ãºltimos pedidos</button>
      </mat-menu>
      <span matLine>{{ pessoa.nome }}</span>
      <span matLine class="mat-line-secondary">{{
        pessoa.celular | mask: masksEnum.celular
      }}</span>
    </mat-list-item>
  </virtual-scroller>
</mat-nav-list>
